#!/usr/bin/env bash
# Generate stub files for CI when Convex backend is not available

set -e

echo "Generating stub files for CI..."

# Create directories
mkdir -p convex/_generated
mkdir -p src

# Generate convex/_generated/server.ts stub
cat > convex/_generated/server.ts << 'EOF'
// Stub file for CI - generated by scripts/generate-stubs.sh

export interface QueryCtx {
  db: {
    query: (table: string) => {
      order: (order: string) => {
        take: (n: number) => Promise<any[]>;
      };
    };
  };
}

export interface MutationCtx extends QueryCtx {
  db: {
    query: (table: string) => any;
    insert: (table: string, doc: any) => Promise<any>;
    patch: (id: any, fields: any) => Promise<void>;
    delete: (id: any) => Promise<void>;
  };
}

export const query = <Args = any, Output = any>(config: {
  args?: Args;
  handler: (ctx: QueryCtx, args?: Args) => Promise<Output>;
}) => config;

export const mutation = <Args = any, Output = any>(config: {
  args?: Args;
  handler: (ctx: MutationCtx, args?: Args) => Promise<Output>;
}) => config;

export const action = (fn: any) => fn;
export const internalQuery = (fn: any) => fn;
export const internalMutation = (fn: any) => fn;
export const internalAction = (fn: any) => fn;
EOF

# Generate convex/_generated/api.ts stub
cat > convex/_generated/api.ts << 'EOF'
// Stub file for CI - generated by scripts/generate-stubs.sh
export const api = {
  tasks: {
    list: {} as any,
    getByStatus: {} as any,
    getWorkload: {} as any,
  },
};
EOF

# Generate src/routeTree.gen.ts stub
cat > src/routeTree.gen.ts << 'EOF'
// Stub file for CI - generated by scripts/generate-stubs.sh
// This is a minimal stub to satisfy TypeScript during CI when TanStack Router
// codegen hasn't run. The actual routeTree will be generated by the router plugin.

export const routeTree: any = {
  __root__: {} as any,
}
EOF

echo "âœ… Stub files generated successfully"
